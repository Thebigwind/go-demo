## MHA的组成

2.1MHA Node（数据节点）
MHA Node运行在每台MySQL服务器上

2.2MHA Manager（管理节点）

MHA Manager可以单独部署在一台独立的机器上，管理多个Master-Slave集群；也可以部署在一台Slave节点上

MHA Manager会定时探测集群中的master节点。当master出现故障时，它可以自动将最新数据的Slave提升为新的Master，然后将所有其他的Slave重新指向新的Master

整个故障迁移的过程对应用程序完全透明




## MHA特点

自动故障切换的过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据不丢失

使用半同步复制，可以大大降低数据丢失的风险，如果只有一个Slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的Slave服务器上，因此可以保证所有节点的数据一致性

目前MHA支持一主多从架构，最少三台服务，即一主两从
MHA：为了解决的是故障切换、数据尽可能地保存，以及所有节点日志地一致性





## MHA工作原理（流程）

MHA有3个部分

核心是主从
**Manager 管理节点**：管理数据库集群信息，定义、触发故障切换

**Node 数据节点**：主要负责保存日志、比较中继日志，选择主备

MHA会通过Node监控MySQL数据库服务地节点信息，定期检测和返回Master角色地健康状态（健康检查）

MHA通过将VIP定义在Master节点上，并且数据库的访问也从此VIP进入，当Master异常时，MHA会进行"故障切换"，就是VIP漂移+二进制日志保存

漂移到主备节点后，会通过脚本命令来控制MySQL服务器角色的变更，例如将主-备服务器变更为主服务器，将其他的从服务器指向新的主服务器，来继续运行

**MHA工作原理总结如下：**
1.从宕机崩溃的master保存二进制日志时间（binlog events）
2.识别含有最新的更新的slave日志
3.应用差异的中继日志（relay log）到其他的slave
4.应用从master保存的二进制日志事件
5.提升一个slave为新的master
6.使其他的slave联机新的master进行复制




